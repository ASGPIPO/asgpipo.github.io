<!DOCTYPE html>
<html lang="en" style="font-size: 105%">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <meta name="author" content="">

  
  
  <meta name="description" content="匹配类型

  
      
          修饰符
          含义
          示例
      
  
  
      
          =
          精确匹配
          location = /api
      
      
          ^~
          前缀匹配，匹配到就停止
          location ^~ /static/
      
      
          ~
          正则匹配（区分大小写）
          location ~ \.php$
      
      
          ~*
          正则匹配（不区分大小写）
          `location ~* .(jpg|gif|png)$
      
      
          无
          普通前缀匹配
          location /api/
      
  




精确匹配">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://asgpipo.github.io//images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://asgpipo.github.io//images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://asgpipo.github.io//images/favicon-16x16.png">

  
  
  <meta name="keywords" content='hugo latex theme blog texify texify2 texify3 michael neuper'>
  

  
  
  <link rel="stylesheet" href='/katex/katex.min.css'>
<script defer defer src='/katex/katex.min.js'></script>
<script defer src='/katex/contrib/auto-render.min.js'></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          delimiters: [
              {left: '$$', right: '$$', display: true},
              {left: '$', right: '$', display: false},
              {left: '\\(', right: '\\)', display: false},
              {left: '\\[', right: '\\]', display: true}
          ],
          throwOnError : false
        });
    });
</script>
  

  
  

  
  <meta property="og:url" content="https://asgpipo.github.io/posts/nginx/location%E5%8C%B9%E9%85%8D/">
  <meta property="og:site_name" content="pipo&#39;s site">
  <meta property="og:title" content="Location匹配">
  <meta property="og:description" content="匹配类型 修饰符 含义 示例 = 精确匹配 location = /api ^~ 前缀匹配，匹配到就停止 location ^~ /static/ ~ 正则匹配（区分大小写） location ~ \.php$ ~* 正则匹配（不区分大小写） `location ~* .(jpg|gif|png)$ 无 普通前缀匹配 location /api/ 精确匹配">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-12-15T11:54:12+08:00">
    <meta property="article:modified_time" content="2025-12-15T11:54:12+08:00">
    <meta property="article:tag" content="Location">
    <meta property="article:tag" content="Host">
    <meta property="article:tag" content="Linux">


  
  <link rel="canonical" href="https://asgpipo.github.io/posts/nginx/location%E5%8C%B9%E9%85%8D/">

  
  
  
  <meta itemprop="name" content="Location匹配">
  <meta itemprop="description" content="匹配类型 修饰符 含义 示例 = 精确匹配 location = /api ^~ 前缀匹配，匹配到就停止 location ^~ /static/ ~ 正则匹配（区分大小写） location ~ \.php$ ~* 正则匹配（不区分大小写） `location ~* .(jpg|gif|png)$ 无 普通前缀匹配 location /api/ 精确匹配">
  <meta itemprop="datePublished" content="2025-12-15T11:54:12+08:00">
  <meta itemprop="dateModified" content="2025-12-15T11:54:12+08:00">
  <meta itemprop="wordCount" content="1289">
  <meta itemprop="keywords" content="Location,Host,Linux">

  
  
  
    <link rel="stylesheet" href="/css/common.min.e562d763c6d0825495eb17de8b2c1d9800cf7c08db1c36accedf77a5fccfc4b9.css" integrity="sha256-5WLXY8bQglSV6xfeiywdmADPfAjbHDaszt93pfzPxLk=" crossorigin="anonymous">
  

  
  
    <link rel="stylesheet" href="/css/content.min.0eb2d1d2ea35e8a94b4208bf1bd8b30a84fc7bc8329a7b795c3db4ed9088ecfb.css" integrity="sha256-DrLR0uo16KlLQgi/G9izCoT8e8gymnt5XD207ZCI7Ps=" crossorigin="anonymous">
  

  
  
  <title>Location匹配 - pipo&#39;s site</title>
  

  
  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Location匹配">
  <meta name="twitter:description" content="匹配类型 修饰符 含义 示例 = 精确匹配 location = /api ^~ 前缀匹配，匹配到就停止 location ^~ /static/ ~ 正则匹配（区分大小写） location ~ \.php$ ~* 正则匹配（不区分大小写） `location ~* .(jpg|gif|png)$ 无 普通前缀匹配 location /api/ 精确匹配">


  


  <link rel="stylesheet" href="/css/single.min.be779f459ad7e3aaf8afd0f80c6a61ca6c50993f5f18512532100ac6d93f0fa9.css" integrity="sha256-vnefRZrX46r4r9D4DGphymxQmT9fGFElMhAKxtk/D6k=" crossorigin="anonymous">


  <link rel="stylesheet" href="/css/single.min.78a121b7d7a160420f9daab0ea13add66c37b9c44f27bba07b27207e2b0975d2.css" integrity="sha256-eKEht9ehYEIPnaqw6hOt1mw3ucRPJ7ugeycgfisJddI=" crossorigin="anonymous">


</head>

<body>
  <div id="wrapper">
    


<header id="header">
  <h1>
    <a href="https://asgpipo.github.io/">blog collcetions</a>
    <button id="dark-mode-toggle" class="dark-mode-toggle" aria-label="Toggle theme">
        <svg width="2rem" height="2rem" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 496">
        <path fill="currentColor" d="M8,256C8,393,119,504,256,504S504,393,504,256,393,8,256,8,8,119,8,256ZM256,440V72a184,184,0,0,1,0,368Z" transform="translate(-8 -8)"/>
        </svg>
    </button>
  </h1>

  <nav>
    
    <span class="nav-bar-item">
      
        <span class="icon"><svg width="1em" height="1em" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M17,11H16a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2Zm0,4H16a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2ZM11,9h6a1,1,0,0,0,0-2H11a1,1,0,0,0,0,2ZM21,3H7A1,1,0,0,0,6,4V7H3A1,1,0,0,0,2,8V18a3,3,0,0,0,3,3H18a4,4,0,0,0,4-4V4A1,1,0,0,0,21,3ZM6,18a1,1,0,0,1-2,0V9H6Zm14-1a2,2,0,0,1-2,2H7.82A3,3,0,0,0,8,18V5H20Zm-9-4h1a1,1,0,0,0,0-2H11a1,1,0,0,0,0,2Zm0,4h1a1,1,0,0,0,0-2H11a1,1,0,0,0,0,2Z"/></svg>
</span>
      
      <a class="link" href="/posts/">Blog</a>
    </span>
    
    <span class="nav-bar-item">
      
        <span class="icon"><svg width="1em" height="1em" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M2.88,16.88a3,3,0,0,0,0,4.24,3,3,0,0,0,4.24,0,3,3,0,0,0-4.24-4.24Zm2.83,2.83a1,1,0,0,1-1.42-1.42,1,1,0,0,1,1.42,0A1,1,0,0,1,5.71,19.71ZM5,12a1,1,0,0,0,0,2,5,5,0,0,1,5,5,1,1,0,0,0,2,0,7,7,0,0,0-7-7ZM5,8a1,1,0,0,0,0,2,9,9,0,0,1,9,9,1,1,0,0,0,2,0,11.08,11.08,0,0,0-3.22-7.78A11.08,11.08,0,0,0,5,8Zm10.61.39A15.11,15.11,0,0,0,5,4,1,1,0,0,0,5,6,13,13,0,0,1,18,19a1,1,0,0,0,2,0A15.11,15.11,0,0,0,15.61,8.39Z"/></svg>
</span>
      
      <a class="link" href="/index.xml">RSS</a>
    </span>
    
    <span class="nav-bar-item">
      
        <span class="icon"><svg width="1em" height="1em" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" data-name="Layer 1">
<path d="M10.07031,20.50291a1.00008,1.00008,0,0,0-1.18115-.9834c-1.30908.24024-2.96191.27637-3.40137-.958a5.70754,5.70754,0,0,0-1.83691-2.415,1.20073,1.20073,0,0,1-.1665-.10938,1,1,0,0,0-.93067-.64551H2.54883a.99965.99965,0,0,0-1,.99512c-.00391.81543.811,1.33789,1.1416,1.51465a4.4408,4.4408,0,0,1,.92383,1.35937c.36426,1.02344,1.42285,2.57617,4.46582,2.376.001.03516.00195.06836.00244.09863l.00439.26758a1,1,0,0,0,2,0l-.00488-.31836C10.07715,21.4951,10.07031,21.22068,10.07031,20.50291Zm10.667-15.126c.03174-.125.063-.26367.09034-.41992a6.27792,6.27792,0,0,0-.40821-3.293,1.002,1.002,0,0,0-.61572-.58007c-.356-.12012-1.67041-.35645-4.18408,1.25a13.86918,13.86918,0,0,0-6.354,0C6.76221.751,5.45459.9658,5.10205,1.07908a.99744.99744,0,0,0-.63135.584,6.3003,6.3003,0,0,0-.40332,3.35644c.02442.12793.05078.2461.07813.35449A6.26928,6.26928,0,0,0,2.89014,9.20311a8.42168,8.42168,0,0,0,.04248.92187c.334,4.60254,3.334,5.98438,5.42431,6.459-.04345.125-.083.25878-.11816.40039a1.00023,1.00023,0,0,0,1.94238.47851,1.6784,1.6784,0,0,1,.46778-.87793.99947.99947,0,0,0-.5459-1.74512c-3.4541-.39453-4.95362-1.80175-5.1792-4.89843a6.61076,6.61076,0,0,1-.03369-.73828,4.25769,4.25769,0,0,1,.91943-2.71289,3.022,3.022,0,0,1,.1958-.23145.99988.99988,0,0,0,.188-1.02441,3.3876,3.3876,0,0,1-.15527-.55567A4.09356,4.09356,0,0,1,6.1167,3.06346a7.54263,7.54263,0,0,1,2.415,1.17968,1.00877,1.00877,0,0,0,.82764.13282,11.77716,11.77716,0,0,1,6.17285.001,1.00549,1.00549,0,0,0,.83056-.13769,7.572,7.572,0,0,1,2.40528-1.19043,4.03977,4.03977,0,0,1,.0874,1.57812,3.205,3.205,0,0,1-.16895.60743.9999.9999,0,0,0,.188,1.02441c.07715.08691.1543.18066.22363.26855A4.12186,4.12186,0,0,1,20,9.20311a7.03888,7.03888,0,0,1-.0376.77734c-.22021,3.05566-1.72558,4.46387-5.1958,4.85937a1,1,0,0,0-.54541,1.7461,1.63079,1.63079,0,0,1,.46631.9082,3.06079,3.06079,0,0,1,.09229.81934v2.334C14.77,21.2949,14.77,21.78025,14.77,22.00291a1,1,0,1,0,2,0c0-.2168,0-.69238.00977-1.33984V18.31346a4.8815,4.8815,0,0,0-.15479-1.31153,4.25638,4.25638,0,0,0-.11621-.416,6.51258,6.51258,0,0,0,5.44531-6.42383A8.69677,8.69677,0,0,0,22,9.20311,6.13062,6.13062,0,0,0,20.7373,5.37693Z"/></svg>
</span>
      
      <a class="link" href="https://github.com/ASGPIPO">GitHub</a>
    </span>
    
  </nav>
</header>
<hr class="head-rule"></hr>
    
<main id="main" class="post">
  
  <div class="post-heading">
    <h1 class="post-title">Location匹配</h1>
    <div class="publish-metadata">
      
      <svg width="0.75em" height="0.75em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M3 9H21M7 3V5M17 3V5M6 13H8M6 17H8M11 13H13M11 17H13M16 13H18M16 17H18M6.2 21H17.8C18.9201 21 19.4802 21 19.908 20.782C20.2843 20.5903 20.5903 20.2843 20.782 19.908C21 19.4802 21 18.9201 21 17.8V8.2C21 7.07989 21 6.51984 20.782 6.09202C20.5903 5.71569 20.2843 5.40973 19.908 5.21799C19.4802 5 18.9201 5 17.8 5H6.2C5.0799 5 4.51984 5 4.09202 5.21799C3.71569 5.40973 3.40973 5.71569 3.21799 6.09202C3 6.51984 3 7.07989 3 8.2V17.8C3 18.9201 3 19.4802 3.21799 19.908C3.40973 20.2843 3.71569 20.5903 4.09202 20.782C4.51984 21 5.07989 21 6.2 21Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      15 December 2025
      
      
        &nbsp;
        <span>
          <svg width="0.75em" height="0.75em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M15.4998 5.49994L18.3282 8.32837M3 20.9997L3.04745 20.6675C3.21536 19.4922 3.29932 18.9045 3.49029 18.3558C3.65975 17.8689 3.89124 17.4059 4.17906 16.9783C4.50341 16.4963 4.92319 16.0765 5.76274 15.237L17.4107 3.58896C18.1918 2.80791 19.4581 2.80791 20.2392 3.58896C21.0202 4.37001 21.0202 5.63634 20.2392 6.41739L8.37744 18.2791C7.61579 19.0408 7.23497 19.4216 6.8012 19.7244C6.41618 19.9932 6.00093 20.2159 5.56398 20.3879C5.07171 20.5817 4.54375 20.6882 3.48793 20.9012L3 20.9997Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          1289 words
        </span>
      
      
      
        
      
      
        &nbsp;
        <span>
          <svg width="0.75em" height="0.75em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 7V12L14.5 13.5M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          ~3 mins
        </span>
      
    </div>
  </div>

  
  <div>
    
    <a class="link tag" href='https://asgpipo.github.io/tags/location'>#Location</a>
    
    <a class="link tag" href='https://asgpipo.github.io/tags/host'>#Host</a>
    
    <a class="link tag" href='https://asgpipo.github.io/tags/linux'>#Linux</a>
    
    <br></br>
  </div>
  
  
  
  <details>
    <summary>
      <b>Table of Contents</b>
    </summary>
    <div class="toc numbered-subtitles"><nav id="TableOfContents">
  <ul>
    <li><a href="#匹配类型">匹配类型</a></li>
    <li><a href="#优先级">优先级</a></li>
    <li><a href="#拼接规则">拼接规则</a>
      <ul>
        <li><a href="#root--index">root &amp; index</a></li>
        <li><a href="#alias">alias</a></li>
        <li><a href="#巨坑">巨坑</a></li>
      </ul>
    </li>
    <li><a href="#reference">Reference</a></li>
  </ul>
</nav></div>
  </details>
  
  
  <article class="content numbered-subtitles">
    
    <h2 id="匹配类型">匹配类型</h2>
<table>
  <thead>
      <tr>
          <th>修饰符</th>
          <th>含义</th>
          <th>示例</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>=</code></td>
          <td>精确匹配</td>
          <td><code>location = /api</code></td>
      </tr>
      <tr>
          <td><code>^~</code></td>
          <td>前缀匹配，匹配到就停止</td>
          <td><code>location ^~ /static/</code></td>
      </tr>
      <tr>
          <td><code>~</code></td>
          <td>正则匹配（区分大小写）</td>
          <td><code>location ~ \.php$</code></td>
      </tr>
      <tr>
          <td><code>~*</code></td>
          <td>正则匹配（不区分大小写）</td>
          <td>`location ~* .(jpg|gif|png)$</td>
      </tr>
      <tr>
          <td>无</td>
          <td>普通前缀匹配</td>
          <td><code>location /api/</code></td>
      </tr>
  </tbody>
</table>
<hr>
<ul>
<li>
<p><strong class=chinese>精确匹配</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">location</span> <span class="p">=</span> <span class="s">/api</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="c1">#.....
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">只有访问是</span> <span class="s">example.com/api</span> <span class="s">时才匹配</span>
</span></span><span class="line"><span class="cl"><span class="s">example.com/api/</span> <span class="s">❌</span>
</span></span><span class="line"><span class="cl"><span class="s">example.com/apis</span> <span class="s">❌</span>
</span></span></code></pre></div></li>
<li>
<p>前缀匹配</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">location</span> <span class="s">^~</span> <span class="s">/api/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="c1">#....
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">example.com/api/</span> <span class="s">✅</span>
</span></span><span class="line"><span class="cl"><span class="s">example.com/apis</span> <span class="s">❌</span>
</span></span><span class="line"><span class="cl"><span class="s">example.com/api/123456</span> <span class="s">✅</span>
</span></span></code></pre></div></li>
<li>
<p>正则匹配</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">location</span> <span class="p">~</span><span class="sr">*</span>  <span class="s">\.(jpg|gif|png)</span>$ <span class="p">{</span> <span class="c1">#\. 是转义 $表示结束
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">example.com/avatar.jpg</span> <span class="s">✅</span>
</span></span><span class="line"><span class="cl"><span class="s">exampl.com/logo.svg</span> <span class="s">❌</span>
</span></span><span class="line"><span class="cl"><span class="s">example.com/logo.pngDoSomeDangerAction</span> <span class="s">❌</span>
</span></span><span class="line"><span class="cl"><span class="s">example.com/thepath/logo.png</span> <span class="s">✅</span>
</span></span></code></pre></div></li>
</ul>
<hr>
<h2 id="优先级">优先级</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">高  ┌─────────────────────┐
</span></span><span class="line"><span class="cl">    │  =   精确匹配       │
</span></span><span class="line"><span class="cl">    ├─────────────────────┤
</span></span><span class="line"><span class="cl">    │  ^~  前缀匹配停止   │
</span></span><span class="line"><span class="cl">    ├─────────────────────┤
</span></span><span class="line"><span class="cl">    │  ~   正则（顺序）   │
</span></span><span class="line"><span class="cl">    │  ~*  正则（顺序）   │
</span></span><span class="line"><span class="cl">    ├─────────────────────┤
</span></span><span class="line"><span class="cl">    │  无  最长前缀匹配   │
</span></span><span class="line"><span class="cl">低  └─────────────────────┘
</span></span></code></pre></div><hr>
<h2 id="拼接规则">拼接规则</h2>
<h3 id="root--index">root &amp; index</h3>
<p><code>root</code> 表示文件路径地址的根目录， index 表示当发送的请求是目录时会去该目录下查找的文件;</p>
<p><code>index</code> 指令定义了当用户请求一个目录（而不是一个具体文件）时，Nginx 应该默认返回哪个文件;</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="kn">root</span> <span class="s">/var/www/home/</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="kn">index</span> <span class="s">index.html</span> <span class="s">index.htm</span> <span class="s">index.php</span>
</span></span><span class="line"><span class="cl"><span class="err">}</span>
</span></span></code></pre></div><p>当进入的请求是 <code>example.com/</code> 时 会匹配到上述 location 匹配段 <strong>拆下来 <code>/</code> ，root + <code>/</code>  = <code>var/www/home/</code> 因为查找的是 dir 而非 file</strong> ，所以根据 index 从前往后查找 对应文件 <code>/</code> + index [1] = <code>/index.html</code> 重新在 conf 里匹配 。</p>
<p>因为 <code>/index.html</code> 符合 / 的规则，于是 root  +  <code>/index.html</code>, 此时访问的是具体的文件，检查是否存在然后返回。</p>
<hr>
<h3 id="alias">alias</h3>
<p>alias 常为改善 root 可能导致的 <strong class=chinese>路径重复问题</strong> 而使用。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">location</span> <span class="s">/images/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kn">root</span> <span class="s">/var/www/assets/pics/</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>我们请求访问时如果是 <code>example.com/images/img.png</code> 到这里会被拆解拼接 <strong>为 <code>/var/www/assets/pics/images/img.png</code></strong></p>
<p>但我们实际只是 <strong>暴露给用户的地址是 images 我们的图片路径并不在这里</strong>，此时为了保证 API 的易读性和我们后端资源的有序我们可以使用 <code>alias</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">location</span> <span class="s">/images/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kn">alias</span> <span class="s">/var/www/assets/pics/</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>拼接结果就是 <code>/var/www/assets/pics/img.png</code></p>
<hr>
<h3 id="巨坑">巨坑</h3>
<h4 id="使用精准匹配导致-无法托管正确页面">使用精准匹配导致 无法托管正确页面</h4>
<p>如果我们用精准匹配去设置 根目录为欢迎页，会出错</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">location</span> <span class="p">=</span><span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="kn">root</span> <span class="s">/var/www/home/</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="kn">index</span> <span class="s">index.html</span> <span class="s">index.htm</span> <span class="s">index.php</span>
</span></span><span class="line"><span class="cl"><span class="err">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">1977/12/15 15:45:24 [debug] 332923#332923: *17 http request line</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;GET / HTTP/1.1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">1977/12/15 15:45:24 [debug] 332923#332923: *17 http uri</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">1977/12/15 15:45:24 [debug] 332923#332923: *17 http args</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">1977/12/15 15:45:24 [debug] 332923#332923: *17 http exten</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">1977/12/15 15:45:24 [debug] 332923#332923: *17 http header</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Accept: */*&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">1977/12/15 15:45:24 [debug] 332923#332923</span><span class="p">:</span><span class="w"> </span><span class="cp">*17</span><span class="w"> </span><span class="l">http header done</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">1977/12/15 15:45:24 [debug] 332923#332923: *17 test location</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/avatar/&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">1977/12/15 15:45:24 [debug] 332923#332923: *17 test location</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/404.html&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">1977/12/15 15:45:24 [debug] 332923#332923: *17 test location</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">1977/12/15 15:45:24 [debug] 332923#332923</span><span class="p">:</span><span class="w"> </span><span class="cp">*17</span><span class="w"> </span><span class="l">using configuration &#34;=/&#34;   </span><span class="w"> </span><span class="c">#使用“=/精准匹配”</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">1977/12/15 15:45:24 [debug] 332923#332923</span><span class="p">:</span><span class="w"> </span><span class="cp">*17</span><span class="w"> </span><span class="l">open index &#34;/var/www/home/index.html&#34;</span><span class="w"> </span><span class="c">#检查index.html是否存在</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">1977/12/15 15:45:24 [debug] 332923#332923: *17 internal redirect</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/index.html?&#34;</span><span class="w"> </span><span class="c">#内部重定向</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">1977/12/15 15:45:24 [debug] 332923#332923: *17 rewrite phase</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">1977/12/15 15:45:24 [debug] 332923#332923: *17 test location</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/avatar/&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">1977/12/15 15:45:24 [debug] 332923#332923: *17 test location</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/static/&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">1977/12/15 15:45:24 [debug] 332923#332923: *17 test location</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/health&#34;</span><span class="w"> </span><span class="c">#找不到了因为 /index.html 不匹配 /</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">1977/12/15 15:45:24 [error] 332923#332923</span><span class="p">:</span><span class="w"> </span><span class="cp">*17</span><span class="w"> </span><span class="l">open() &#34;/etc/nginx/html/index.html&#34; failed (2: No such file or directory), client: 127.0.0.1, server: localhost, request: &#34;GET / HTTP/1.1&#34;, host: &#34;localhost:8070&#34; </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">1977/12/15 15:45:24 [debug] 332923#332923: *17 http finalize request</span><span class="p">:</span><span class="w"> </span><span class="m">404</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;/index.html?&#34;</span><span class="w"> </span><span class="l">a:1, c:2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">1977/12/15 15:45:24 [debug] 332923#332923: *17 http special response</span><span class="p">:</span><span class="w"> </span><span class="m">404</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;/index.html?&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">1977/12/15 15:45:24 [debug] 332923#332923: *17 internal redirect</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/404.html?&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">1977/12/15 15:45:24 [debug] 332923#332923: *17 rewrite phase</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">1977/12/15 15:45:24 [debug] 332923#332923: *17 test location</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/avatar/&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">1977/12/15 15:45:24 [debug] 332923#332923: *17 test location</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/404.html&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">1977/12/15 15:45:24 [debug] 332923#332923</span><span class="p">:</span><span class="w"> </span><span class="cp">*17</span><span class="w"> </span><span class="l">using configuration &#34;=/404.html&#34;</span><span class="w">
</span></span></span></code></pre></div><p><strong class=chinese>解决方案</strong></p>
<ol>
<li>
<p>使用 try_files</p>
<blockquote>
<p>try_files 检查文件是否按指定顺序存在，并使用 第一个用于请求处理的寻得文件; 处理过程 在当前语境下执行。</p>
<p>Checks the existence of files in the specified order and uses the first found file for request processing;</p>
</blockquote>
<p>这样就避免了内部重定向</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">location</span> <span class="p">=</span><span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="kn">root</span> <span class="s">/var/www/home/</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="kn">try_files</span> <span class="s">/index.html</span> <span class="p">=</span><span class="mi">404</span> 
</span></span><span class="line"><span class="cl"><span class="err">}</span>
</span></span></code></pre></div></li>
<li>
<p>将 root 放在全局</p>
</li>
</ol>
<p><strong>admin/ 与 admin 同时跳转同一 index</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">location</span> <span class="s">/admin</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kn">alias</span> <span class="s">/var/www/admin/</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kn">index</span> <span class="s">index.html</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kn">try_files</span> <span class="nv">$uri</span> <span class="nv">$uri/index.html</span> <span class="p">=</span><span class="mi">404</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><hr>
<h2 id="reference">Reference</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">title: &#34;Nginx基础知识从小白到入门&#34;
</span></span><span class="line"><span class="cl">image: &#34;https://raw.githubusercontent.com/wsgzao/storage-public/master/img/20191113180648.png&#34;
</span></span><span class="line"><span class="cl">description: &#34;Nginx基础知识从小白到入门&#34;
</span></span><span class="line"><span class="cl">url: &#34;https://wsgzao.github.io/post/nginx/&#34;
</span></span><span class="line"><span class="cl">favicon: &#34;&#34;
</span></span><span class="line"><span class="cl">aspectRatio: &#34;96.79245283018868&#34;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">title: &#34;Nginx 快速教程&#34;
</span></span><span class="line"><span class="cl">image: &#34;https://raw.githubusercontent.com/dunwu/images/master/cs/web/nginx/nginx.jpg&#34;
</span></span><span class="line"><span class="cl">description: &#34;nginx-tutorial&#34;
</span></span><span class="line"><span class="cl">url: &#34;https://dunwu.github.io/nginx-tutorial/#/nginx-quickstart&#34;
</span></span><span class="line"><span class="cl">favicon: &#34;&#34;
</span></span><span class="line"><span class="cl">aspectRatio: &#34;56.26959247648903&#34;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">title: &#34;Nginx 从入门到实践（2023年版）Nginx 简介 Nginx 是什么 nginx (engine x) 是一个  - 掘金&#34;
</span></span><span class="line"><span class="cl">image: &#34;https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/75209bc63f284481ae19c0c98d41187e~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?&#34;
</span></span><span class="line"><span class="cl">description: &#34;Nginx 简介 Nginx 是什么 nginx (engine x) 是一个 HTTP 和反向代理服务器，一个邮件代理服务器，一个通用的 TCP/UDP 代理服务器，最初由 Igor Sysoev &#34;
</span></span><span class="line"><span class="cl">url: &#34;https://juejin.cn/post/7223653286464667703#heading-20&#34;
</span></span><span class="line"><span class="cl">favicon: &#34;&#34;
</span></span><span class="line"><span class="cl">aspectRatio: &#34;96.18268575323789&#34;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">title: &#34;try_files 文档&#34;
</span></span><span class="line"><span class="cl">image: &#34;https://nginx.org/img/nginx_logo.svg&#34;
</span></span><span class="line"><span class="cl">description: &#34;&#34;
</span></span><span class="line"><span class="cl">url: &#34;https://nginx.org/en/docs/http/ngx_http_core_module.html#try_files&#34;
</span></span><span class="line"><span class="cl">favicon: &#34;&#34;
</span></span><span class="line"><span class="cl">aspectRatio: &#34;28.666666666666668&#34;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">title: &#34;index 文档&#34;
</span></span><span class="line"><span class="cl">image: &#34;https://nginx.org/img/nginx_logo.svg&#34;
</span></span><span class="line"><span class="cl">description: &#34;&#34;
</span></span><span class="line"><span class="cl">url: &#34;https://nginx.org/en/docs/http/ngx_http_index_module.html#index&#34;
</span></span><span class="line"><span class="cl">favicon: &#34;&#34;
</span></span><span class="line"><span class="cl">aspectRatio: &#34;28.666666666666668&#34;
</span></span></code></pre></div>
    
  </article>

  <button onclick="topFunction()" id="back-to-top" title="Go to top">Back to Top</button>

  

<div id="sharingbuttons">
    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    
</div>
  <div class="paginator">
    
    <a class="link" href="https://asgpipo.github.io/posts/nginx/nginx%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/" title="Nginx快速入门">← prev</a>
    
    
    <a class="link" href="https://asgpipo.github.io/posts/nginx/%E8%B7%A8%E5%9F%9F/" title="跨域">next →</a>
    
  </div>
  <div class="comment">
    
    
    
      <script src="https://giscus.app/client.js"
        data-repo="michaelneuper/website"
        data-repo-id="R_kgDOIjPNaQ"
        data-category="General"
        data-category-id="DIC_kwDOIjPNac4CaklA"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="gruvbox"
        data-lang="en"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
  </script>
  
  </div>
  
  
</main>

    <footer id="footer">
  <div>
    <span>Powered by  <a class=link href=https://gohugo.io target=_blank rel=noopener>Hugo</a> | 
Theme <a class=link href=https://github.com/michaelneuper/hugo-texify3 target=_blank rel=noopener>TeXify3</a>
</span>
  </div>
  <div>
    <span>Copyright © 2026 </span>
  </div>
</footer>

  </div>

  
  <script src='https://asgpipo.github.io/js/script.js' defer></script>

  
  
  <link media="screen" rel="stylesheet" href="https://asgpipo.github.io/css/syntax.css" />
  
  <link media="screen" rel="stylesheet" href="https://asgpipo.github.io/css/scale.css" />
  

  
  

  
  

</body>

</html>
